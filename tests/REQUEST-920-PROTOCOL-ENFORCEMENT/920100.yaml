---
  meta: 
    author: "csanders-git"
    enabled: true
    name: "Tests-920350"
    description: "Description"
  tests: 
    - 
      # Standard GET request
      rule_id: 920100-1
      stages: 
        - 
          stage: 
            input:
              dest_addr: "127.0.0.1"
              method: "GET"
              port: 80
              headers:
                  User-Agent: "ModSecurity CRS 3 Tests"              
                  Host: "localhost"
              protocol: "http"
              uri: "/"
              version: "HTTP/1.1"
            output: 
              no_log_contains: "id \"920100\""
    - 
      # Request has tab (\t) before request method - Apache complains
      # AH00126: Invalid URI in request      GET / HTTP/1.1
      rule_id: 920100-2
      stages: 
        - 
          stage: 
            input:
              dest_addr: "127.0.0.1"
              method: "     GET"
              port: 80
              headers:
                  User-Agent: "ModSecurity CRS 3 Tests"              
                  Host: "localhost"
              protocol: "http"
              uri: "/"
              version: "HTTP/1.1"
            output: 
              status: 400           
    - 
      # Perfectly valid OPTIONS request
      rule_id: 9201000-3
      stages: 
        - 
          stage: 
            input:
              dest_addr: "127.0.0.1"
              method: "OPTIONS"
              port: 80
              headers:
                  User-Agent: "ModSecurity CRS 3 Tests"              
                  Host: "localhost"
              protocol: "http"
              uri: "*"
              version: "HTTP/1.1"
            output: 
              no_log_contains: "id \"920100\""
    - 
      # Valid CONNECT request however this is disabled by Apache default
      rule_id: 920100-4
      stages: 
        - 
          stage: 
            input:
              dest_addr: "127.0.0.1"
              method: "CONNECT"
              port: 80
              headers:
                  User-Agent: "ModSecurity CRS 3 Tests"              
                  Host: "localhost"
              protocol: "http"
              uri: "1.2.3.4:80"
              version: "HTTP/1.1"
            output: 
              status: 405
    - 
      # invalid Connect request, domains require ports
      rule_id: 920100-5
      stages: 
        - 
          stage: 
            input:
              dest_addr: "127.0.0.1"
              method: "CONNECT"
              port: 80
              headers:
                  User-Agent: "ModSecurity CRS 3 Tests"              
                  Host: "localhost"
              protocol: "http"
              uri: "www.cnn.com"
              version: "HTTP/1.1"
            output: 
              status: 400
    - 
      # This is an acceptable CONNECT request for SSL tunneling
      rule_id: 920100-6
      stages: 
        - 
          stage: 
            input:
              dest_addr: "127.0.0.1"
              method: "CONNECT"
              port: 80
              headers:
                  User-Agent: "ModSecurity CRS 3 Tests #FP"              
                  Host: "localhost"
              protocol: "http"
              uri: "www.cnn.com:80"
              version: "HTTP/1.1"
            output: 
              log_contains: "id \"920100\""             
    - 
      # Valid request with query and anchor components
      rule_id: 920100-7
      stages: 
        - 
          stage: 
            input:
              dest_addr: "127.0.0.1"
              method: "GET"
              port: 80
              headers:
                  User-Agent: "ModSecurity CRS 3 Tests"              
                  Host: "localhost"
              protocol: "http"
              uri: "/index.html?I=Like&Apples=Today#tag"
              version: "HTTP/1.1"
            output: 
              no_log_contains: "id \"920100\""         
    - 
      # The colon in the path is not allowed. Apache will block by default
      # (20024)The given path is misformatted or contained invalid characters: [client 127.0.0.1:4142] AH00127: Cannot map GET /index.html:80?I=Like&Apples=Today#tag HTTP/1.1 to file
      rule_id: 920100-8
      stages: 
        - 
          stage: 
            input:
              dest_addr: "127.0.0.1"
              method: "GET"
              port: 80
              headers:
                  User-Agent: "ModSecurity CRS 3 Tests"              
                  Host: "localhost"
              protocol: "http"
              uri: "/index.html:80?I=Like&Apples=Today#tag"
              version: "HTTP/1.1"
            output: 
              status: 403
    - 
      # Normal Options request with path
      rule_id: 920100-9
      stages: 
        - 
          stage: 
            input:
              dest_addr: "127.0.0.1"
              method: "OPTIONS"
              port: 80
              headers:
                  User-Agent: "ModSecurity CRS 3 Tests"              
                  Host: "localhost"
              protocol: "http"
              uri: "/"
              version: "HTTP/1.1"
            output: 
              no_log_contains: "id \"920100\""   
    - 
      # An invalid method with a long name
      rule_id: 920100-10
      stages: 
        - 
          stage: 
            input:
              dest_addr: "127.0.0.1"
              method: "REALLYLONGUNREALMETHOD"
              port: 80
              headers:
                  User-Agent: "ModSecurity CRS 3 Tests # FN"              
                  Host: "localhost"
              protocol: "http"
              uri: "/"
              version: "HTTP/1.1"
            output: 
              log_contains: "id \"920100\""       
    - 
      # An invalid request because a backslash is used in uri
      rule_id: 920100-11
      stages: 
        - 
          stage: 
            input:
              dest_addr: "127.0.0.1"
              port: 80
              headers:
                  User-Agent: "ModSecurity CRS 3 Tests # FN"              
                  Host: "localhost"
              protocol: "http"
              uri: "\\"
              version: "HTTP/1.1"
            output: 
              log_contains: "id \"920100\""               
